<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.26-DEV" />


<title>Linux 上使用 Shadowsocks 教程 - Fanach - 翻那墙</title>
<meta property="og:title" content="Linux 上使用 Shadowsocks 教程 - Fanach - 翻那墙">



  






<link rel="stylesheet" href="https://fanach.github.io/css/main.css" media="all">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400|Lato:400,400italic,700">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://fanach.github.io/" class="nav-logo">
    <img src="https://fanach.github.io/images/favicon.ico" 
         width="50" 
         height="50" 
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="https://fanach.github.io/">Articles</a></li>
    
    <li><a href="https://fanach.github.io/downloads/">Downloads</a></li>
    
    <li><a href="https://fanach.github.io/about/">About</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">2 min read</span>
    

    <h1 class="article-title">Linux 上使用 Shadowsocks 教程</h1>

    
    <span class="article-date">July 6, 2017</span>
    

    <div class="article-content">
      

<p><center>
<img src="linux-icon.svg" width=128/></p>

<p>Linux
</center></p>

<p>本文简要叙述 Linux 设备中 Shadowsocks 客户端的安装、配置和使用过程。</p>

<h1 id="下载软件">下载软件</h1>

<p>下载 Linux 上的通用 Shadowsocks 软件，点击下载 <a href="https://github.com/fanach/download/releases/download/latest/shadowsocks-local-linux32-1.1.5.gz">shadowsocks-local-linux32-1.1.5.gz</a> 。</p>

<blockquote>
<p>这是一个 Go 语言版的 32 位与 64 位通用二进制客户端。源程序见 GitHub <a href="https://github.com/shadowsocks/shadowsocks-go">shadowsocks/shadowsocks-go</a></p>
</blockquote>

<p>如果没有可视化浏览器，那么可以用在命令行下载。</p>

<pre><code class="language-sh">wget https://github.com/fanach/download/releases/download/latest/shadowsocks-local-linux32-1.1.5.gz
</code></pre>

<p><center>
<img src="linux-shadowsocks-01.png" width="95%"/></p>

<p>图 1. Linux 下载 Shadowsocks
</center></p>

<h1 id="解压与安装">解压与安装</h1>

<p>下载后，得到 <code>shadowsocks-local-linux32-1.1.5.gz</code>，用 gzip 解压。</p>

<p>接着，增加可执行权限。</p>

<pre><code class="language-sh">$ gzip -d shadowsocks-local-linux32-1.1.5.gz

$ chmod +x shadowsocks-local-linux32-1.1.5
</code></pre>

<p><center>
<img src="linux-shadowsocks-02.png" width="95%"/></p>

<p>图 2. 解压与添加权限
</center></p>

<h1 id="运行">运行</h1>

<p>查看运行参数。</p>

<p><center>
<img src="linux-shadowsocks-03.png" width="95%"/></p>

<p>图 3. 运行参数
</center></p>

<p>根据提供的帐号信息，替换下面命令中的服务器地址、服务器端口和密码，本地端口设为 <code>1080</code>。</p>

<pre><code class="language-sh">$ ./shadowsocks-local-linux32-1.1.5 -s 112.113.114.115 -p 8388 -k abc123 -l 1080
</code></pre>

<p>上面命令中，<code>112.113.114.115</code> 为服务器地址，<code>8388</code> 为服务器端口，<code>abc123</code> 为密码，
<code>1080</code> 为本地端口。</p>

<p><center>
<img src="linux-shadowsocks-04.png" width="95%"/></p>

<p>图 4. 运行 Shadowsocks
</center></p>

<p>启动后，将在本地 <code>127.0.0.1:1080</code> 代理请求到服务端。</p>

<h1 id="配置代理">配置代理</h1>

<p>如果有可视化浏览器，进入浏览器设置，配置代理。以 Firefox 为例子。</p>

<p>在 Firefox 地址栏直接输入 <code>about:preferences#advanced</code> 打开高级设置页面。</p>

<p><center>
<img src="linux-shadowsocks-05.png" width="95%"/></p>

<p>图 5. Firefox 高级设置
</center></p>

<p>找到 “Advanced” -&gt; “Network” -&gt; “Settings&hellip;”，打开代理配置面板。</p>

<p>选择 “Manual proxy configuration”，清空 “HTTP Proxy”、“SSL Proxy”、“FTP Proxy”，
并设置 “SOCKS HOST” 地址为 <code>127.0.0.1</code>，端口为 <code>1080</code>（本地端口），类型为 “SOCKS v5”。</p>

<p><center>
<img src="linux-shadowsocks-06.png" width="95%"/></p>

<p>图 6. 设置代理
</center></p>

<p>拖到下面，勾选 “Proxy DNS when using SOCKS v5”，让 DNS 服务也走代理。</p>

<p><center>
<img src="linux-shadowsocks-07.png" width="95%"/></p>

<p>图 7. 代理 DNS
</center></p>

<p>点击 “OK” 保存，完成配置。</p>

<h1 id="验证是否成功">验证是否成功</h1>

<p>打开新的窗口里，开始科学上网。</p>

<p>试试被墙网站：<a href="https://google.com">Google</a>，<a href="https://twitter.com">Twitter</a>，<a href="https://youtube.com">YouTube</a>。</p>

<p><center>
<img src="linux-shadowsocks-08.png" width="95%"/></p>

<p>图 8. 打开 Google 试试
</center></p>

<p>如果连接不成功，检查帐号配置、代理配置，并留意控制台输出信息。</p>

<h1 id="为-chrome-chromium-设置代理">为 Chrome / Chromium 设置代理</h1>

<p>见 《<a href="http://fanach.github.io/post/chrome-proxy/">为 Chrome / Chromium 设置代理</a>》。</p>

<h1 id="简化启动命令-拓展部分">简化启动命令（拓展部分）</h1>

<p>如果不想每次都要进入下载目录，然后敲老长老长的一个命令，才启动 Shadowsocks。而是想能
在任何一个控制台执行 <code>ss</code>，就能启动，那么继续阅读。</p>

<h2 id="重命名与移动">重命名与移动</h2>

<p>重命名为 <code>sslocal</code> 并移动到某个 <code>$PATH</code> 下。</p>

<pre><code class="language-sh">$ sudo mv shadowsocks-local-linux32-1.1.5 /usr/local/bin/sslocal
</code></pre>

<h2 id="创建配置文件">创建配置文件</h2>

<p>创建目录 <code>/etc/shadowsocks</code> ，在里面新建文件 <code>ok.json</code>，并粘入配置。</p>

<pre><code class="language-sh">$ sudo mkdir /etc/shadowsocks
$ sudo vim /etc/shadowsocks/ok.json
</code></pre>

<p>粘贴如下配置。</p>

<pre><code class="language-json">{
    &quot;server&quot;: &quot;112.113.114.115&quot;,
    &quot;server_port&quot;: 8388,
    &quot;password&quot;: &quot;abc123&quot;,
    &quot;method&quot;: &quot;aes-256-cfb&quot;,
    &quot;local_address&quot;: &quot;0.0.0.0&quot;,
    &quot;local_port&quot;: 1080,
    &quot;timeout&quot;: 600
}
</code></pre>

<p>上面命令中，<code>112.113.114.115</code> 为服务器地址，<code>8388</code> 为服务器端口，<code>abc123</code> 为密码，
<code>1080</code> 为本地端口，<code>timeout</code> 为连接超时。加密方式大小写不分。</p>

<h2 id="创建脚本">创建脚本</h2>

<p>创建可执行文件 <code>/usr/local/bin/ss</code>，用于启动 <code>sslocal</code>。</p>

<pre><code class="language-sh">$ sudo vim /usr/local/bin/ss
</code></pre>

<p>粘贴如下内容。</p>

<pre><code class="language-sh">#!/bin/sh
sslocal -c /etc/shadowsocks/ok.json
</code></pre>

<p>不要忘了添加可执行权限。</p>

<pre><code class="language-sh">$ sudo chmod +x /usr/local/bin/ss
</code></pre>

<p>这样，想要启动 Shadowsocks 只需要在任意窗口执行 <code>ss</code> 便好了。</p>

<p><center>
<img src="linux-shadowsocks-09.png" width="95%"/></p>

<p>图 9. 简化后的命令
</center></p>

<p>以后如果更换了服务器，只需要修改文件 <code>/etc/shadowsocks/ok.json</code> 即可。</p>

<h1 id="为命令行程序设置代理-拓展部分">为命令行程序设置代理（拓展部分）</h1>

<p>上面配置后，代理对浏览器生效。但一些命令行程序还需要单独设置。</p>

<h2 id="给-git-设置代理">给 git 设置代理</h2>

<p>修改 <code>~/.gitconfig</code> 文件，在最后添加下面内容。</p>

<pre><code>[https]
	proxy = socks5://127.0.0.1:1080
[http]
	proxy = socks5://127.0.0.1:1080
</code></pre>

<p>保存后，所有 <code>git pull</code> 和 <code>git push</code> 都会经过代理。</p>

<h2 id="给-go-设置代理">给 go 设置代理</h2>

<p>在使用 <code>go get</code> 去下 <code>gopkg.in</code> 、<code>golang.org</code> 或者 <code>code.google.com</code>
这些依赖时，有时等很久，根本不会成功。出现 <code>i/o timeout</code> 错误。</p>

<p>这时在启动了 ss 情况下，设置两个变量就好了。</p>

<pre><code class="language-sh">$ export http_proxy=sock5://127.0.0.1:1080
$ export https_proxy=sock5://127.0.0.1:1080
</code></pre>

<p>这样，再次试试</p>

<pre><code>$ go get golang.org/x/crypto/bcrypt
</code></pre>

<blockquote>
<p>导入的变量作用域只在当前控制台窗口。别的窗口需要再次设置。如要永久设置，需要添加到
环境变量里去。</p>
</blockquote>

<h2 id="通用配置-proxychains">通用配置（ProxyChains）</h2>

<p><code>curl</code> 和 <code>wget</code> 也有相关的 proxy 参数设置代理，但如果每次都加上多余的参数就比较
累了。还有一些命令行程序，如 <code>ping</code>、<code>docker</code>，似乎就没有支持代理的参数或配置文件。</p>

<p>所以下面用一种通用的方式，来实现统一代理，需要安装 ProxyChains 。实现的效果是，在
命令行程序及其参数之前，加上 <code>proxychains4</code> 就能走代理。</p>

<h3 id="安装-proxychains">安装 ProxyChains</h3>

<p>Archlinux 执行：</p>

<pre><code class="language-sh">$ sudo pacman -S community/proxychains-ng
</code></pre>

<p>Ubuntu / Debian 执行：</p>

<pre><code class="language-sh">$ sudo apt-get install proxychains
</code></pre>

<p>CentOS / RedHat / Fedora 需要从源码构建：</p>

<pre><code class="language-sh">$ yum install git gcc make -y
$ git clone https://github.com/rofl0r/proxychains-ng.git --depth=1
$ cd proxychains-ng
$ ./configure
$ make &amp;&amp; make install &amp;&amp; make install-config
</code></pre>

<h3 id="修改配置">修改配置</h3>

<p>修改配置文件 <code>/etc/proxychains.conf</code>，在最后添加：</p>

<pre><code>socks5  127.0.0.1 1080
</code></pre>

<blockquote>
<p>通过源码构建安装的，配置文件路径为 <code>/usr/local/etc/proxychains.conf</code>。</p>
</blockquote>

<h3 id="使用-proxychains">使用 proxychains</h3>

<p>先设置一下 alias。</p>

<pre><code class="language-sh">$ alias p4='proxychains4'
</code></pre>

<p>在需要的命令及其参数之前，加上 p4</p>

<pre><code class="language-sh">$ p4 &lt;commands&gt; &lt;args&gt;
</code></pre>

<p>如：</p>

<pre><code class="language-sh">$ proxychains4 curl https://www.google.com.hk
</code></pre>

<p><center>
<img src="linux-shadowsocks-10.png" width="95%"/></p>

<p>图 10. 使用 ProxyChain 给 curl 代理
</center></p>

<blockquote>
<p>ProxyChains 适用于大多数命令行程序，所以也可以试试在 <code>git</code> 和 <code>go</code> 加上 <code>p4</code>。</p>
</blockquote>

<h1 id="tips">Tips</h1>

<ol>
<li>注意加密方式默认为 AES-256-CFB；</li>
</ol>

<h1 id="法律法规">法律法规</h1>

<p>帐号仅用于 <strong>科学研究</strong> 和 <strong>学术交流</strong> 用途，请务必遵守相关法规，转发敏感内容需要慎重。</p>

<p><center>
<img src="ss-law.png" width="95%"/>
</center></p>

<p>任何个人和组织使用网络应当遵守宪法法律，遵守公共秩序，尊重社会公德，不得危害网络安全，
不得利用网络从事危害国家安全、荣誉和利益，煽动颠覆国家政权、推翻社会主义制度，煽动分裂
国家、破坏国家统一，宣扬恐怖主义、极端主义，宣扬民族仇恨、民族歧视，传播暴力、淫秽色情
信息，编造、传播虚假信息扰乱经济秩序和社会秩序，以及侵害他人名誉、隐私、知识产权和其他
合法权益等活动。</p>

<p>附：《<a href="http://www.miit.gov.cn/n1146295/n1146557/n1146614/c5345009/content.html">中华人民共和国网络安全法</a>》</p>

<h1 id="修改历史">修改历史</h1>

<ul>
<li>2017.06.16 调节空格与缩进。</li>
<li>2017.06.01 适配图片到移动设备。</li>
</ul>

    </div>
  </article>

  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "fanach" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://fanach.github.io/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="https://fanach.github.io/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

